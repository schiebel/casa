<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>

<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">


<task type="function" name="imrebin" category="analysis">

    <shortdescription>Rebin an image by the specified integer factors</shortdescription>

    <input>
        <param type="string" name="imagename" mustexist="true">
            <description>Name of the input image</description>
            <value/>
            <example>imagenam='ngc5921.im'</example>
        </param>
        <param type="string" direction="in" name="outfile">
            <description>Output image name.</description>
            <value/>
        </param>
        <param type="intArray"  name="factor">
            <description>Binning factors for each axis. Use imhead or ia.summary to determine axis ordering.</description>
        </param>
        <param type="any" direction="in" name="region">
            <any type="variant"/>
            <description>The region to rebin. Default is entire image. Do not specify region and box/chans simultaneously.</description>
            <value>""</value>
        </param>
        <param type="string" direction="in" name="box" subparam="true">
            <value></value>
            <description>Box in directional plane to rebin. Default is to use the entire directional plane.</description>
        </param>
        <param type="string" direction="in" name="chans" subparam="true">
            <description>Channels to rebin. See "help par.chans" for examples. Default is all channels</description>
            <value></value>
        </param>
        <param type="string" direction="in" name="stokes" subparam="true">
            <description>The correlations to include in the output. Default is all. Stokes planes cannot be rebinned.</description>
            <value/>
        </param>
        <param type="string" direction="in" name="mask">
            <description>Mask to use. See help par.mask. Default is none.</description>
            <value/>
        </param>
        <param type="bool"  name="dropdeg">
            <description>Drop degenerate axes?</description>
            <value>False</value>
        </param>
        <param type="bool" direction="in" name="overwrite" subparam="true">
            <description>Overwrite the output if it exists? Default False</description>
            <value>False</value>
        </param>
       
        <param type="bool" direction="in" name="stretch" subparam="true">
            <description>Stretch the mask if necessary and possible? See help par.stretch </description>
            <value>False</value>
        </param>
        <param type="bool" name="crop">
            <description>Remove pixels from the end of an axis to be rebinned if there are not enough to form an integral bin?</description>
            <value>True</value>
        </param>
        <constraints>
            <when param="outfile">
                <notequals type="string" value="">
                    <default param="overwrite">
                        <value>False</value>
                    </default>
                </notequals>
            </when>
            <when param="region">
                <equals type="string" value="">
                    <default param="box">
                        <value>""</value>
                    </default>
                    <default param="chans">
                        <value>""</value>
                    </default>
                    <default param="stokes">
                        <value>""</value>
                    </default>
                </equals>
            </when>
            <when param="mask">
                <notequals type="string" value="">
                   <default param="stretch"><value type="bool">False</value></default>
             </notequals>
         </when>
        </constraints>
    </input>
    <returns type="bool"/>
    <example>
PARAMETER SUMMARY
imagename        Name of the input (CASA, FITS, MIRIAD) image
outfile          Name of output CASA image. Must be specified.
factor           Array of binning factors for each axis, eg [2,3]. Use imhead or ia.summary()
                 to determine order of axes in your image.
region           Region to use. Do not specify region and box/chans/stokes simultaneously.
                 See help par.region for details.
box              Direction plane box specification, "blcx, blcy, trcx, trcy". Only one box
                 may be specified. Default is entire directional plane.
chans            Optional contiguous frequency channel number specification. See "help par.chans"
                 for examples. Default is all channels.
stokes           Stokes planes specification. Not used if region is specified. Default is all stokes.
mask             Mask to use. See help par.mask. Default is none.
dropdeg          Drop degenerate axes?
overwrite        Should the image of the same name as specified in outfile be overwritten?
                 If true, the file if it exists is automatically overwritten.
stretch          Stretch the input mask if necessary and possible. See help par.mask.
crop             Only considered if the length of the input axis is not an integral multiple of
                 the associated binning factor. If True, pixels at the end of the axis that do not
                 form a complete bin are not included in the binning. If False, the remaining extra
                 pixels are averaged to form the final bin along the axis.

DESCRIPTION

This application rebins the specified image by the specified integer binning
factors for each axis. It supports both float valued and complex valued images.
The corresponding output pixel value is the average of the
input pixel values. The output pixel will be masked False if there
were no good input pixels.  A polarization axis cannot be rebinned.

The binning factors array must contain at least one element and no more
elements than the number of input image axes. If the number of elements
specified is less than the number of image axes, then the remaining axes
not specified are not rebinned. All specified values must be positive. A
value of one indicates that no rebinning of the associated axis will occur.
Should this array contain any float values, they will be rounded to the next
lowest integer. Note that in many images with both frequency and polarization
axes, the polarization axis preceeds the frequency axis. If you wish to rebin
the frequency axis, it is recommended that you inspect your image with imhead
or ia.summary() to determine the axis ordering.

Binning starts from the origin pixel of the bounding box of the selected region or
the origin pixel of the input image if no region is specified. The value of crop
is used to determine how to handle cases where there are pixels
at the end of the axis that do not form a complete bin. If crop=True,
extra pixels at the end of the axis are discarded. If crop=False, the remaining
pixels are averaged into the final bin along that axis. Should the length
of the axis to be rebinned be an integral multiple of the associated binning
factor, the value of crop is irrelevant. 

A value of dropdeg=True will result in the output image not containing
axes that are degenerate in the specified region or in the input image if no
region is specified. Note that, however, the binning
factors array must still account for degenerate axes, and the binning
factor associated with a degenerate axis must always be 1.

EXAMPLE

# rebin the first two axes (normally the direction axes)
imrebin(imagename="my.im", outfile="rebinned.im", factor=[2,3])

# rebin the frequency axis, which is the fourth axis in this image
imrebin(imagename="my2.im", outfile="rebinned2.im", factor=[1,1,1,4])

    </example>
</task>
</casaxml>
